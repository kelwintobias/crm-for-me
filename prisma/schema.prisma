// Configurações do Gerador e Fonte de Dados
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// ENUMS (Padronização solicitada no PRD)
// --------------------------------------

// Origem do Lead (Dropdown fixo)
enum LeadSource {
  INSTAGRAM
  GOOGLE
  INDICACAO
  OUTRO
}

// Planos Simplificados (Substitui o campo numérico R$)
enum PlanType {
  INDEFINIDO
  PLANO_UNICO
  PLANO_MENSAL
}

// Colunas do Kanban (Status do Pipeline)
enum PipelineStage {
  NOVOS
  EM_CONTATO
  VENDIDO_UNICO
  VENDIDO_MENSAL
  PERDIDO
}

// Roles de Usuário (Para controle de reset de senha pelo Admin)
enum UserRole {
  ADMIN
  VENDEDOR
}

// --------------------------------------
// MODELS (Tabelas)
// --------------------------------------

/// Modelo de Usuário
/// Representa os Vendedores e Admins.
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  role      UserRole @default(VENDEDOR)

  // Relacionamentos
  leads     Lead[]   @relation("UserLeads")

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

/// Modelo de Lead (Entidade Principal)
/// Contém os dados do cliente e o estado no Kanban.
model Lead {
  id        String   @id @default(uuid())

  // Dados Básicos (Cadastro Simplificado)
  name      String
  phone     String

  // Classificações (Enums para evitar dados sujos)
  source    LeadSource    @default(INSTAGRAM)
  plan      PlanType      @default(INDEFINIDO)

  // Gestão do Pipeline (Kanban)
  stage     PipelineStage @default(NOVOS)

  // Campos de Texto Livre (Specs do PC ou observações)
  notes     String?  @db.Text

  // Relacionamento com o Vendedor (Quem é o dono do lead)
  userId    String
  user      User     @relation("UserLeads", fields: [userId], references: [id])

  // Timestamps & Soft Delete
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Índices para performance nas queries do Dashboard
  @@index([stage])
  @@index([userId])
  @@index([updatedAt])

  @@map("leads")
}
